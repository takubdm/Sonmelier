<html>
<head>
		<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
		<style>
		*
		{
			font-size: 1em;
			margin: 0;
			padding: 0;
		}
		body
		{
			font-size: 30px;
			font-family: 'メイリオ', Meiryo, 'ＭＳ ゴシック', sans-serif;
		}
		table
		{
			border-collapse: collapse;
			width: 100%;
			height: 100%;
		}
		td, th
		{
			border: 1px solid black;
			font-size: 1em;
		}
		#content
		{
			overflow-y: scroll;
			-webkit-overflow-scrolling: touch;
			height: 100%;
		}
		</style>
</head>
<body>
	<div id="content_wrapper">
	<div id="content">
	<table>
		<tbody>
			<tr>
				<th>Zedd</th>
			</tr>
			<tr>
				<td>Aereogramme</td>
			</tr>
			<tr>
				<td>Arms And Sleepers</td>
			</tr>
			<tr>
				<td>Audrey</td>
			</tr>
			<tr>
				<td>Balmorhea</td>
			</tr>
			<tr>
				<td>Bark Psychosis</td>
			</tr>
			<tr>
				<td>Blu-Swing</td>
			</tr>
			<tr>
				<td>Carta</td>
			</tr>
			<tr>
				<td>Caspian</td>
			</tr>
			<tr>
				<td>Clint Mansell</td>
			</tr>
			<tr>
				<td>Collapse Under the Empire</td>
			</tr>
			<tr>
				<td>Collection of Colonies of Bees</td>
			</tr>
			<tr>
				<td>cosiner</td>
			</tr>
			<tr>
				<td>Eluvium</td>
			</tr>
			<tr>
				<td>Esmerine</td>
			</tr>
			<tr>
				<td>Everything is Made in China</td>
			</tr>
			<tr>
				<td>Exxasens</td>
			</tr>
			<tr>
				<td>Fen</td>
			</tr>
			<tr>
				<td>Flunk</td>
			</tr>
			<tr>
				<td>Gaias Pendulum</td>
			</tr>
			<tr>
				<td>Glider</td>
			</tr>
			<tr>
				<td>Hexenmeister</td>
			</tr>
			<tr>
				<td>If These Trees Could Talk</td>
			</tr>
			<tr>
				<td>Isis</td>
			</tr>
			<tr>
				<td>Jakob</td>
			</tr>
			<tr>
				<td>Joshua Radin</td>
			</tr>
			<tr>
				<td>Kashiwa Daisuke</td>
			</tr>
			<tr>
				<td>lali puna</td>
			</tr>
			<tr>
				<td>Laura</td>
			</tr>
			<tr>
				<td>Little Dragon</td>
			</tr>
			<tr>
				<td>Maurizio Bianchi</td>
			</tr>
			<tr>
				<td>Max Richter</td>
			</tr>
			<tr>
				<td>Maybeshewill</td>
			</tr>
			<tr>
				<td>Metaform</td>
			</tr>
			<tr>
				<td>Mice Parade</td>
			</tr>
			<tr>
				<td>Minus The Bear</td>
			</tr>
			<tr>
				<td>Moving Mountains</td>
			</tr>
			<tr>
				<td>nightmares on wax</td>
			</tr>
			<tr>
				<td>P-Love</td>
			</tr>
			<tr>
				<td>Pele</td>
			</tr>
			<tr>
				<td>Pelican</td>
			</tr>
			<tr>
				<td>Piano Magic</td>
			</tr>
			<tr>
				<td>Plaid</td>
			</tr>
			<tr>
				<td>Rist</td>
			</tr>
			<tr>
				<td>Rosetta</td>
			</tr>
			<tr>
				<td>Special Others</td>
			</tr>
			<tr>
				<td>Steven Halpern</td>
			</tr>
			<tr>
				<td>Surface Of Eceon</td>
			</tr>
			<tr>
				<td>Svartsinn</td>
			</tr>
			<tr>
				<td>Thao Nguyen Xanh</td>
			</tr>
			<tr>
				<td>The Ascent Of Everest</td>
			</tr>
			<tr>
				<td>The Walthall Tango</td>
			</tr>
			<tr>
				<td>This Will Destroy You</td>
			</tr>
			<tr>
				<td>Tides</td>
			</tr>
			<tr>
				<td>Volcano Choir</td>
			</tr>
			<tr>
				<td>Woods of Ypres</td>
			</tr>
			<tr>
				<td>Yasushi Yoshida</td>
			</tr>
			<tr>
				<td>Yume Bitsu</td>
			</tr>
			<tr>
				<td>あテスト</td>
			</tr>
			<tr>
				<td>いテスト</td>
			</tr>
			<tr>
				<td>うテスト</td>
			</tr>
			<tr>
				<td>こテスト</td>
			</tr>
			<tr>
				<td>がテスト</td>
			</tr>
			<tr>
				<td>テスト</td>
			</tr>
			<tr>
				<td>テスト</td>
			</tr>
			<tr>
				<td>テスト</td>
			</tr>
			<tr>
				<td>テスト</td>
			</tr>
			<tr>
				<td>テスト</td>
			</tr>
			<tr>
				<td>テスト</td>
			</tr>
			<tr>
				<td>テスト</td>
			</tr>
			<tr>
				<td>テスト</td>
			</tr>
			<tr>
				<td>テスト</td>
			</tr>
			<tr>
				<td>テスト</td>
			</tr>
			<tr>
				<td>テスト</td>
			</tr>
			<tr>
				<td>テスト</td>
			</tr>
			<tr>
				<td>テスト</td>
			</tr>
			<tr>
				<td>テスト</td>
			</tr>
			<tr>
				<td>テスト</td>
			</tr>
			<tr>
				<td>実</td>
			</tr>
			<tr>
				<td>実</td>
			</tr>
			<tr>
				<td>実</td>
			</tr>
			<tr>
				<td>実</td>
			</tr>
			<tr>
				<td>実</td>
			</tr>
			<tr>
				<td>実</td>
			</tr>
			<tr>
				<td>実</td>
			</tr>
			<tr>
				<td>実</td>
			</tr>
			<tr>
				<td>実</td>
			</tr>
			<tr>
				<td>実</td>
			</tr>
			<tr>
				<td>実</td>
			</tr>
			<tr>
				<td>実</td>
			</tr>
			<tr>
				<td>実</td>
			</tr>
			<tr>
				<td>実</td>
			</tr>
			<tr>
				<td>実</td>
			</tr>
			<tr>
				<td>実</td>
			</tr>
			<tr>
				<td>実</td>
			</tr>
			<tr>
				<td>0at</td>
			</tr>
		</tbody>
	</table>
	</div>
	</div>
	<script src="jquery-1.11.0.min.js" type="text/javascript"></script>
	<script>
	var th = new thSectionIndex($('#content_wrapper>#content'), $('#content>table>tbody>tr>td'));
	th.addMergeRule([
		["A", "[A-D]", true],
		["E", "[E-H]", true],
		["I", "[I-L]", true],
		["M", "[M-P]", true],
		["Q", "[Q-T]", true],
		["U", "[U-Z]", true],
		["あ", "[ぁ-ん]", false],
		["ア", "[ァ-ヶ]", false],
		["漢", "[亜-熙]", false],
		["#", "[0-9]", false]
	]);
	th.appendScrollBar($('#content_wrapper'));

	function thSectionIndex(_slideArea, _slideContent)
	{
		var sectionIndex;
		var slideArea;
		var slideContent;
		var elemPos = [];
		var barWidth = 15;
		var barOffset = 5;
		var barOffsetRight = 5;
		var barPadding = 10;
		var BAR_FONT_SIZE = '12px';
		var caps = [];
		var mergeRule = [];
		var isMerged = false;

		var constructor = function(_slideArea, _slideContent)
		{
			slideArea = _slideArea;
			slideContent = _slideContent;
		}
		var getMatchedRule = function(char)
		{
			var matchedRule = null;
			for (var i=0, l=mergeRule.length; i<l; i++)
			{
				var rule = mergeRule[i];
				if (char.match(rule[1]))
				{
					matchedRule = rule;
				}
			}
			return matchedRule;
		}
		var registElemPos = function()
		{
			if (slideArea.length == 0) throw('Slide area should be defined before defining slide slideArea.');
			var currentChar = '';
			var appliedRule = '';
			slideContent.each(function(i) {
				var capital  = $(this).text().substr(0, 1).toUpperCase();
				var myRule = getMatchedRule(capital);
				if (capital != currentChar)
				{
					elemPos.push([capital, $(this).position().top-slideArea.position().top]);
					currentChar = capital;
					if (myRule == null)
					{
						caps.push("<div>"+capital+"</div>");
						appliedRule = null;
						isMerged = false;
					}
					else if (isMerged)
					{
						caps.push("<div style='margin-top: -0.4em; margin-bottom: -0.2em;'>●</div>");
						isMerged = false;
					}
					else if (myRule[0] != appliedRule)
					{
						caps.push("<div>"+myRule[0]+"</div>");
						appliedRule = myRule[0];
						isMerged = myRule[2];
					}
				}
			});
			createScrollBar();
		}
		var createScrollBar = function()
		{
			var content = slideArea;
			sectionIndex = $( "<div>", {
				"class": "thScrollBar",
				"css": {
					"width": barWidth+"px",
					"height": slideArea.height()+parseInt(slideArea.css('padding-top'))+parseInt(slideArea.css('padding-bottom'))-barOffset*2-barPadding*2+"px",
					"position": "absolute",
					"left": slideArea.offset().left+parseInt(slideArea.css('padding-left'))+parseInt(slideArea.css('padding-right'))+slideArea.width()+"px",
					"top": slideArea.offset().top+barOffset+"px",
					"margin-left": -barWidth-barOffsetRight-barPadding*2+"px",
					"user-select": "none",
					"text-align": "center",
					"font-size": BAR_FONT_SIZE,
					"font-weight": "bold",
					"-moz-border-radius": (barWidth+barPadding*2)/2+"px",
					"-webkit-border-radius": (barWidth+barPadding*2)/2+"px",
					"-o-border-radius": (barWidth+barPadding*2)/2+"px",
					"-ms-border-radius": (barWidth+barPadding*2)/2+"px",
					"padding": barPadding+"px"
				},
				"html": caps.join('')
			});
			//
		}
		var getNormalizedPageY = function(pageY)
		{
			return pageY-slideArea.offset().top;
			//-parseInt(slideArea.css('padding-left'))-parseInt(slideArea.css('padding-right'));
		}
		var thTouchStart = function(e)
		{
			$(this).css({
				"background-color": "#999",
				"opacity": "0.5"
			});
			$(this).trigger('touchmove', getNormalizedPageY(e.originalEvent.changedTouches[0].pageY));
			return false;
		}
		var thTouchEnd = function(e)
		{
			$(this).css({
				"background-color": "rgba(0, 0, 0, 0)",
				"opacity": "1"
			});

		}
		var thTouchMove = function(e, pageY)
		{
			e.preventDefault();
			var scroll = {
				"start": 0+barOffset*2,
				"end": $(sectionIndex).height()-barOffset,
				"length": ($(sectionIndex).height()-barOffset)-(0+barOffset)
			};

			// Normalize y if necessary.
			var y = (pageY == null) ? e.originalEvent.changedTouches[0].pageY : pageY;
			y = getNormalizedPageY(y);
			if (y <= scroll.start) y = scroll.start;
			if (y > scroll.end) y = scroll.end;

			//
			var split = elemPos.length;
			var ratio = (y-barOffset)/scroll.length;
			var hit = 0;
			var sp = 1/split;
			for (var i=0, l=split; i<l; i++)
			{
				if (i*sp <= ratio && ratio < (i+1)*sp)
				{
					hit = i;
					break;
				}
			}
			if (ratio == 1) hit = split-1;
			slideArea.scrollTop(elemPos[hit][1]);
		}
		this.overwriteRule = function(_rule)
		{
			mergeRule = [];
			self.addMergeRule(_rule);
		}
		this.addMergeRule = function(_rule)
		{
			var rule = _rule;
			if (rule instanceof Array == false)
			{
				rule = [_rule];
			}
			for (var i=0, l=rule.length; i<l; i++)
			{
				mergeRule.push(rule[i]);
			}
		}
		this.appendScrollBar = function(_content)
		{
			registElemPos();
			$(sectionIndex).appendTo(_content);
			$(sectionIndex).bind('touchend', thTouchEnd);
			$(sectionIndex).bind('touchstart', thTouchStart);
			$(sectionIndex).bind('touchmove', thTouchMove);
		}
		this.defineSlideArea = function(_slideArea)
		{
			slideArea = _slideArea;
		}
		this.defineSlideContent = function(_slideContent)
		{
			slideContent = _slideContent;
		}
		//
		if (_slideArea && _slideContent) constructor(_slideArea, _slideContent);
	}
	</script>
</body>
</html>

